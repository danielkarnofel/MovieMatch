<!DOCTYPE html>
<html>
<%- include('partials/head.ejs') %>
<body>
<%- include('partials/header.ejs') %>

<main>

  <section class="hero">
    <h1>Welcome to MovieMatch</h1>
    <p>Discover movies that match your mood — whether you're feeling adventurous, emotional, or just need a feel-good escape.</p>
    <p>Explore, rate, and save films that vibe with you. Your next favorite movie is just a mood away.</p>
  </section>

  <section>
    <% const topPick = popularMovies.results[0]; %>
    <h1>Your Top Pick</h1>
    <div href="/movie" class="highlight">
      <a href="/movie?title=<%= topPick.title %>&poster=<%= topPick.poster_path %>">
        <img src="http://image.tmdb.org/t/p/w154<%= topPick.poster_path %>" alt="<%= topPick.title %>">
      </a>
      <div class="highlight-text">
        <h3><%= topPick.title %></h3>
        <p><%= topPick.overview %></p>
      </div>
    </div>
  </section>

  <section>
    <h1>Recommended Moods</h1>
    <div class="mood-container">
      <a href="/mood">Feel good</a>
      <a href="/mood">Heartwarming</a>
      <a href="/mood">Cerebral</a>
    </div>
  </section>

  <section>
    <h1>Quote of the Day</h1>
    <div class="quote">
      <p>“Be yourself; everyone else is already taken.”<br><em>― Oscar Wilde</em></p>
    </div>
  </section>

  <section>
    <h1>Trending Movies</h1>
    <div class="gallery">
      <% for (let i = 0; i < 6; i++) { %>
        <% const movie = popularMovies.results[i]; %>
        <% if (movie && movie.poster_path) { %>
          <div class="gallery-item">
            <a href="/movie?title=<%= movie.title %>&poster=<%= movie.poster_path %>">
              <img src="http://image.tmdb.org/t/p/w154<%= movie.poster_path %>" alt="<%= movie.title %>">
            </a>
          </div>
        <% } %>
      <% } %>
    </div>
  </section>

  <% 
    const lists = {};
    userListsWithMovies.forEach(row => {
      if (!lists[row.list_name]) lists[row.list_name] = [];
      if (row.poster_url) lists[row.list_name].push(row);
    });
  %>

  <% Object.keys(lists).forEach(listName => { %>
    <section>
      <a href="/list"><h2><%= listName %></h2></a>
      <div class="gallery">
        <% lists[listName].forEach(movie => { %>
          <div class="gallery-item">
            <a href="/movie?title=<%= encodeURIComponent(movie.movie_title) %>&poster=<%= movie.poster_url %>">
                <img src="<%= movie.poster_url %>" alt="<%= movie.movie_title %>">
            </a>

          </div>
        <% }) %>
      </div>
    </section>
  <% }) %>

</main>

<%- include('partials/footer.ejs') %>
</body>
</html>
